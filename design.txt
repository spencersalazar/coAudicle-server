
Within a given server, miniAudicle live-coding sessions are organized into individual rooms. After joining a room, all of the users actions in Play mode will be broadcasted and recreated for every other user in the room. 


* REST API *

TODO create room, public/private rooms

===
/rooms
(GET) List all rooms on the server

- Output (JSON) -
[ 
    {
        name: "name",
        uuid: "uuid"
        info: "miscellaneous information (for user display)"
    },
    (info of additional rooms)
]

=== 
/rooms/{uuid}
(GET) List members of the room

- Output (JSON) -
[
    {
        name: "username"
    },
    (info of additional users)
]

===
/rooms/{uuid}/join
(POST) Join the specified room

- Input (www-form-urlencoded, mandatory) -
user_id     globally unique user ID (ASCII)
user_name   user's non-unique display handle (alphanumeric)

- Output -
{ status: 200, msg: "OK" }

===
/rooms/{uuid}/leave
(POST) leave the specified room

- Input (www-form-urlencoded, mandatory) -
user_id     globally unique user ID (ASCII)

- Output -
{ status: 200, msg: "OK" }

===
/rooms/{uuid}/actions
(GET) List all actions of the room. Exclude actions not after actionID, if it is provided. A client should poll this method frequently to receive new actions from other users in the session. 

- Input (urlencoded GET string, optional) -
after   only actions after this actionID are returned (numeric)

- Output (JSON) -
[
    {
        aid: actionID,
        user_id: 'uniqueUserID',
        (additional action data - see ACTIONS)
    },
    (additional actions)
]

===
/rooms/{uuid}/submit
(POST) Submit action to the room for broadcast. 

- Input (www-form-urlencoded, mandatory) -
user_id globally unique user ID (ASCII)     
action  JSON string of action (see ACTIONS below)

- Output -
{ status: 200, msg: "OK" }


* ACTIONS *

TODO loop + sequence

=== Join Room ===
Automatically generated by server when user calls /rooms/{uuid}/join.

- JSON keys -
aid         (number) numeric id (generated by server)
user_id     (string) user uuid (globally unique)
type        (string) always "join"
user_name   (string) user name (displayed to user)

=== Leave Room ===
Automatically generated by server when user calls /rooms/{uuid}/leave.

- JSON keys -
aid     (number) numeric id (generated by server)
user_id (string) user uuid (globally unique)
type    (string) always "leave"

=== New Script ===
- JSON keys -
aid     (number) numeric id (generated by server)
user_id (string) user uuid
type    (string) always "new"
code_id (string) script uuid (globally unique)
name    (string) script name (e.g. title of file, displayed to user)
code    (string) script ChucK code
pos_x   (float)  x position of script on screen
pos_y   (float)  y position of script on screen

A script must have a corresponding New Script action before it can be added/removed/replaced. 

=== Edit Script ===
- JSON keys -
aid     (number) numeric id (generated by server)
type    (string) always "edit"
code_id (string) code uuid
edits   (int)    bitmask of edited properties
                 bit 0: script name
                     1: chuck code
                     2: x/y position
name    (string) new script name
code    (string) new ChucK code
pos_x   (float)  x position of script on screen
pos_y   (float)  y position of script on screen

=== Delete Script ===
- JSON keys -
aid     (number) numeric id (generated by server)
type    (string) always "delete"
code_id (string) code uuid

=== Add Shred ===
- JSON keys -
aid     (number) numeric id (generated by server)
type    (string) always "add"
code_id (string) code uuid

=== Replace Shred ===
- JSON keys -
aid     (number) numeric id (generated by server)
type    (string) always "replace"
code_id (string) code uuid

=== Remove Shred ===
- JSON keys -
aid     (number) numeric id (generated by server)
type    (string) always "remove"
code_id (string) code uuid
num     (number, optional) delete the num-th version of the shred


